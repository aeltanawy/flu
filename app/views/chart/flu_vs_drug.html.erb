<div id="container" style="width:100%; height:500px;">
  <script type="text/javascript">
    $(function () {
      var myChart = Highcharts.chart('container', {
        chart: {
          type: 'column'
        },
        title: {
          text: 'Flu vs. Drug Crude Mortality Rate (CMR) per 100,1000 population in 2016'
        },
        xAxis: {
          title: {
            text: 'US States'
          },
          categories: <%= raw @state_all %>
        },
        yAxis: {
          title: {
            text: 'Number of Deaths in 2016'
          },
        },
        tooltip: {
          formatter: function () {
            var states = <%= raw @state_name %>;
            var i;
            var len = states.length;
            for (i = 0; i < len; i++) {
              if (states[i][0] == this.x) {
                var title = states[i].join(', ');
              }
            }
            var data = '<b>' + title + '</b><br>';
            $.each(this.points, function (i, point) {
              data += '<span style="color:' + point.color + '; font-weight:bold">‚óè ' +  point.series.name + ': </span>' + point.y + '<br>';
            });
            return data;
          },
          shared: true,
        },
        series: [{
          name: 'Flu CMR',
          data: <%= raw @flu_rate %>
        }, {
          name: 'Drug CMR',
          data: <%= raw @drug_rate %>
        }]
      });
    });
  </script>
</div>

<h3>Data for year 2016</h3>
<table class="table table-striped table-hover table-responsive">
  <thead>
    <tr>
      <th>State</th>
      <th>Flu Mortality</th>
      <th>Drug Mortality</th>
      <th>Flu Crude Mortality Rate</th>
      <th>Drug Crude Mortality Rate</th>
      <th>State Population</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% i = -1 %>
    <% @states.each do |state| %>
      <% i += 1 %>
      <% flu = @flu_2016_db.find_by_state_id(state.id)%>
      <% flu_death = flu.deaths %>
      <% drug = @drug_2016_db.find_by_state_id(state.id)%>
      <% drug_death = drug.deaths %>
      <% state_pop = @population_db.find_by_state_id(state.id) %>
      <tr>
        <td><%= state.name %></td>
        <td><%= flu_death %></td>
        <td><%= drug_death %></td>
        <td><%= @flu_rate[i] %></td>
        <td><%= @drug_rate[i] %></td>
        <td><%= state_pop.year_2016 %></td>
      </tr>
    <% end %>
  </tbody>
</table>
